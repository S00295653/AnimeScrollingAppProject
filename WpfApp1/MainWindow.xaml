<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="AnimeScrollApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Anime Scroll" 
        Height="800" Width="450"
        WindowStyle="None" ResizeMode="NoResize"
        Background="Black">

    <Window.Resources>
        <Color x:Key="MainAccentColor">#E94560</Color>
        <SolidColorBrush x:Key="AccentBrush" Color="{StaticResource MainAccentColor}"/>

        <Style TargetType="Window">
            <Setter Property="MinHeight" Value="800"/>
            <Setter Property="MinWidth" Value="450"/>
        </Style>
    </Window.Resources>

    <Grid>
        <ScrollViewer x:Name="MainScrollViewer"
                      VerticalScrollBarVisibility="Hidden"
                      HorizontalScrollBarVisibility="Disabled"
                      PanningMode="None"
                      PreviewMouseWheel="ScrollViewer_PreviewMouseWheel"
                      Focusable="False">
            <StackPanel>
                <StackPanel x:Name="AnimeContainer" 
                           MouseMove="AnimeContainer_MouseMove" 
                           MouseLeftButtonDown="AnimeContainer_MouseLeftButtonDown" 
                           MouseLeftButtonUp="AnimeContainer_MouseLeftButtonUp">
                </StackPanel>

                <!-- ===== ⏳ CORRECTION 4 : Zone de loading avec hauteur augmentée pour respirer ===== -->
                <Grid x:Name="LoadingArea" 
                      Height="400" 
                      Background="Transparent" 
                      Visibility="Collapsed"
                      VerticalAlignment="Top">
                    <Border Background="#15000000" 
                            CornerRadius="15" 
                            Margin="40,80"
                            Padding="40,35"
                            BorderBrush="{StaticResource AccentBrush}" 
                            BorderThickness="1">

                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <!-- Cercle tournant simple et élégant -->
                            <Grid Width="60" Height="60" Margin="0,0,0,25">
                                <!-- Cercle de fond subtil -->
                                <Ellipse Stroke="#2A2A2A" StrokeThickness="3" Opacity="0.3"/>

                                <!-- Cercle tournant principal -->
                                <Ellipse Stroke="{StaticResource AccentBrush}" 
                                         StrokeThickness="3" 
                                         StrokeDashArray="30,10"
                                         RenderTransformOrigin="0.5,0.5">
                                    <Ellipse.RenderTransform>
                                        <RotateTransform x:Name="SpinTransform" Angle="0"/>
                                    </Ellipse.RenderTransform>
                                    <Ellipse.Triggers>
                                        <EventTrigger RoutedEvent="Loaded">
                                            <BeginStoryboard>
                                                <Storyboard>
                                                    <DoubleAnimation Storyboard.TargetName="SpinTransform" 
                                                                     Storyboard.TargetProperty="Angle"
                                                                     From="0" To="360" 
                                                                     Duration="0:0:1.5" 
                                                                     RepeatBehavior="Forever">
                                                        <DoubleAnimation.EasingFunction>
                                                            <QuadraticEase EasingMode="EaseInOut"/>
                                                        </DoubleAnimation.EasingFunction>
                                                    </DoubleAnimation>
                                                </Storyboard>
                                            </BeginStoryboard>
                                        </EventTrigger>
                                    </Ellipse.Triggers>
                                </Ellipse>
                            </Grid>

                            <!-- Texte exact demandé avec espacement confortable -->
                            <TextBlock Text="🔍 Recherche en cours..." 
                                       FontSize="16" 
                                       Foreground="White" 
                                       FontWeight="SemiBold" 
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,8"/>

                            <TextBlock Text="Exploration de nouveaux animes sur AniList" 
                                       FontSize="12" 
                                       Foreground="#888888" 
                                       HorizontalAlignment="Center"
                                       TextWrapping="Wrap"
                                       MaxWidth="300"
                                       TextAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>
                <!-- ===== FIN CORRECTION 4 ===== -->
            </StackPanel>
        </ScrollViewer>

        <Grid VerticalAlignment="Top" HorizontalAlignment="Right" Margin="15">
            <StackPanel>
                <Button Content="✕" Click="CloseButton_Click" Width="35" Height="35" Foreground="White" Background="#80000000" BorderThickness="0" Cursor="Hand" Margin="0,0,0,10">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="18">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource AccentBrush}"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
                <Border Background="#A0000000" CornerRadius="15" Padding="10,5">
                    <TextBlock x:Name="AnimeCounter" Text="0 animes" Foreground="White" FontSize="11" FontWeight="Bold"/>
                </Border>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
